<?xml version="1.0" encoding="UTF-8"?>
<!--
	Logging is configured:

	1. To display warnings or above from Log4j itself, these appear on stderr
	2. To re-read configuration within 30 seconds when this file changes
	3. To provide two appenders
	   (a) Console. Writes to stdout
	   (b) RollingFile. Set up with the cron triggering policy to trigger every day at 23:45, time zone depends on server set up.
	       Logs are all written under the logs folder. Archives are stored zipped up in a sub-directory based on the current year and month.
	       All files under the base directory that match the "*/app-*.log.gz" glob and are 30 days old or older are deleted at rollover time
-->
<Configuration status="warn" dest="err" monitorInterval="30">
	<Appenders>
		<!-- Appender that writes to console -->
		<Console name="Console" target="SYSTEM_OUT">
			<PatternLayout pattern="%d{HH:mm:ss.SSS} | %t | %level | %logger{1.} | %msg%n"/>
		</Console>

		<!-- Appender that writes to file. Set up described at top of this file -->
		<RollingFile name="RollingFile" fileName="logs/app.log"
					 filePattern="logs/$${date:yyyy-MM}/app-%d{yyyy-MM-dd}.log.gz">
			<PatternLayout pattern="%d{HH:mm:ss.SSS} | %t | %level | %logger{1.} | %msg%n"/>
			<CronTriggeringPolicy schedule="0 45 23 * * ?"/>
			<DefaultRolloverStrategy>
				<Delete basePath="logs" maxDepth="2">
					<IfFileName glob="*/app-*.log.gz" />
					<IfLastModified age="30d" />
				</Delete>
			</DefaultRolloverStrategy>
		</RollingFile>

	</Appenders>
	<Loggers>
		<!--
            Root (top parent) logger. Currently set for errors and above to go to console and log file
        -->
		<Root level="info">
			<AppenderRef ref="Console"/>
			<AppenderRef ref="RollingFile"/>
		</Root>
	</Loggers>
</Configuration>
